# This is the main configuration file for the application.
# https://www.playframework.com/documentation/latest/ConfigFile

play.filters.disabled += "play.filters.csrf.CSRFFilter"
play.filters.disabled += "play.filters.headers.SecurityHeadersFilter"
play.filters.disabled += play.filters.hosts.AllowedHostsFilter

play.http.secret.key="uBgot^R`dMW6]rFElJ2z7x56ykGAF2zv4?^3Mh]Ri[Boux/<wVeZL^Z<WO`Zu<Q3"

play.http.errorHandler = "models.utilities.CustomErrorHandler"

   play.filters {
     enabled += "play.filters.hosts.AllowedHostsFilter"
     disabled += "play.filters.csrf.CSRFFilter"

     hosts {
       allowed = [
         "localhost:9000",
         "localhost:9001",
         "madainqsol.com",
         "*.madainqsol.com"
       ]
     }

     # Configuración de headers de seguridad
       headers {
         # Si necesitas permitir frames
         frameOptions = null
         # Otros headers de seguridad que quieras configurar
         contentSecurityPolicy = null
       }
   }


# =========================================
# DATABASE WRITE (WRITER ENDPOINT - ESCRITURA)
# =========================================
db.default.driver=com.mysql.cj.jdbc.Driver
db.default.url="jdbc:mysql://127.0.0.1/mada?autoReconnect=true&useSSL=false"
db.default.url=${?BASE}
db.default.username=${?USER}
db.default.password=${?KEY}

db.default.hikaricp {
  maximumPoolSize = 20            # (2 vCPUs * 10) - Balance entre recursos y rendimiento
  minimumIdle = 5                 # 25% del maximumPoolSize
  connectionTimeout = 30000       # 30 segundos
  idleTimeout = 300000            # 5 minutos - Libera conexiones inactivas
  maxLifetime = 1800000           # 30 minutos - Previene conexiones zombies
  leakDetectionThreshold = 30000  # 30 segundos para detectar fugas
}

# =========================================
# DATABASE READ (READER ENDPOINT - SÓLO CONSULTAS)
# =========================================
db.read.driver=com.mysql.cj.jdbc.Driver
db.read.url="jdbc:mysql://127.0.0.1/mada?autoReconnect=true&useSSL=false"
db.read.url=${?BASE}
db.read.url=${?BASE2}
db.read.username=${?USER}
db.read.password=${?KEY}

db.read.hikaricp {
  maximumPoolSize = 20            # (2 vCPUs * 10) - Balance entre recursos y rendimiento
  minimumIdle = 5                 # 25% del maximumPoolSize
  connectionTimeout = 30000       # 30 segundos
  idleTimeout = 300000            # 5 minutos - Libera conexiones inactivas
  maxLifetime = 1800000           # 30 minutos - Previene conexiones zombies
  leakDetectionThreshold = 30000  # 30 segundos para detectar fugas

  # Propiedades adicionales recomendadas para RDS
  dataSourceProperties {
    cachePrepStmts = true
    prepStmtCacheSize = 250
    prepStmtCacheSqlLimit = 2048
    useServerPrepStmts = true
    useLocalSessionState = true
    rewriteBatchedStatements = true
    cacheResultSetMetadata = true
    cacheServerConfiguration = true
    elideSetAutoCommits = true
    maintainTimeStats = false
    readOnly = true              # Importante para réplicas de lectura
  }

  # Configuración de resiliencia
  initializationFailTimeout = 60000  # 1 minuto
  validationTimeout = 5000           # 5 segundos
  keepaliveTime = 60000             # 1 minuto

}


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Server and HTTP configuration
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~

play.server {
  # Aumentar el timeout general
  http.idleTimeout = 10m
  http.parser.maxMemoryBuffer = 2GB
}

# Configuración específica de Pekko
pekko {
  http.server {
    idle-timeout = 10m
    request-timeout = 10m
    parsing {
      max-content-length = 2GB
      max-uri-length = 32K
    }
  }
}
# ↓ Esto silencia los WARN de ActorSystemImpl que reportan "Illegal request"
logger."org.apache.pekko.actor.ActorSystemImpl" = "ERROR"


# Configuración del parser HTTP
play.http.parser {
  maxDiskBuffer = 2GB
  maxMemoryBuffer = 2GB
}

# Configuración unificada de parsers
parsers {
  anyContent.maxLength = 2GB
}

play.http.parser.maxMemoryBuffer = 2GB



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Mailer configuration
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~

play.mailer {
  host = "smtp.gmail.com" 
  port = 465 
  ssl = "yes"
  tls = "no"
  tlsRequired = no
  user = ${?MAIL}
  password = ${?MAILKEY}
}


bucket=${?BUCKET}

secretKeyCapcha="basura"
secretKeyCapcha=${?KEYCAPTCHA}

 com.inqsol.cognito {
 	client_id = "70o299ulgr2cejfvbmfecq07q3"
 	client_id = ${?COGNITO_CLIENT_ID}
 	secret = "qtaidikmgrja3tn4taldn37kkhd5hnscl70ta48sddm8puivu8t"
 	secret = ${?COGNITO_SECRET}
 	redirect = "http://localhost:9001/callback"
 	redirect = ${?REDIRECT}
 	login_url = "https://inqsolmadaadmin.auth.us-east-2.amazoncognito.com"
 	login_url = ${?LOGIN_URL}
 	
 	}
	
play.ws.ssl {
  loose.acceptAnyCertificate = true
}





