@(mapDiccionario: Map[String,String], mapPermiso: Map[String,String], userMnu: utilities.UserMnu)

    	
@main("") {

	@menues(mapDiccionario, mapPermiso, userMnu, " ")
	
	@modalContactoCliente()
	
	<div id="mostrarmostrar" style="display:none;">
		@barraTitulo(mapDiccionario, "CLIENTES/PROPIETARIOS: CREAR/MODIFICAR/ELIMINAR", "")
		
		<div id="enCarga" class="blocker" style="display: block;"><br><br><br><br><br><br><h1>En proceso .....</h1></div>
		
		<form id="excel" class="formulario" method="post" action="/clienteMantencionExcel/"> </form>
			
		<div id="tblPrincipal"></div>
		
	</div>
	
	<form id="form_eliminar" method="post" action="/clienteElimina/">
		<input type="hidden" id="form_id_cliente" name="id_cliente">
	</form>
}




<script type="text/javascript">

	window.addEventListener('load', function() {
		document.getElementById('mostrarmostrar').style.display="block";
		vistaPrincipal();
		
	});
	
	const vistaPrincipal = () =>{
		
		document.getElementById('enCarga').style.display="block";
		
		var formData = new FormData();
        $.ajax({
            url: "/routes2/clienteMantencion2/",
            type: "POST",
            method: "POST",
            data: formData,
            cache: false,
            contentType: false,
	     	processData: false,
	     	success: function(rs){
		
				let json = rs;
		
				let tabla =
					+ "<div class=\"noprint\">"
						+ "<table class=\"table table-sm table-condensed table-fluid\"><tr><td><div align=\"center\">"
						+ "<button type=\"button\"  class=\"btn btn-sm btn-success\" onclick=\"document.getElementById('excel').submit()\">"
							+ "Exportar a Excel"
						+ "</button></div></td></tr></table></div>"
			
					+ "<table id=\"tablaPrincipal\" class=\"table table-sm table-hover table-bordered table-condensed table-fluid\">"
						+ "<thead style=\"background-color: #eeeeee\">"
							+ "<TR>"
								+ '<TH>@mapDiccionario.get("RUT")</TH>'
								+ "<TH>RAZON SOCIAL (FULL NAME)</TH>"
								+ "<TH>NOMBRE CORTO (NICK NAME)</TH>"
								+ "<TH>GIRO</TH>"
						        + "<TH>DIRECCION</TH>"
						        + '<TH>@mapDiccionario.get("Region")</TH>'
						        + '<TH>@mapDiccionario.get("Comuna")</TH>'
						        + "<TH>Ciudad y/o Pais</TH>"
						        + "<TH>Contacto</TH>"
						        + "<TH>E-Mail</TH>"
						        + "<TH>Telefono</TH>"
								+ "<TH>EDIT</TH>"
								+ "<TH>DEL</TH>"
							+ "</TR>"
						+ "</thead>"
						+ "<tbody>";
					for(var i in json){
						tabla +=
						 "<TR>"
							+ "<td style=\"text-align:center; min-width:80px\"><a href=\"#\" onclick=\"buscaCliente('"+json[i]["nickName"]+"')\">"+json[i]["rut"]+"</a></td>"
							+ "<td style=\"text-align:left;\"><a href=\"#\" onclick=\"buscaCliente('"+json[i]["nickName"]+"')\">"+json[i]["nombre"]+"</a></td>"
							+ "<td style=\"text-align:left;\"><a href=\"#\" onclick=\"buscaCliente('"+json[i]["nickName"]+"')\">"+json[i]["nickName"]+"</a></td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["giro"]+"</td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["direccion"]+"</td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["region"]+"</td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["comuna"]+"</td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["ciudad"]+"</td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["contactoFactura"]+"</td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["mailFactura"]+"</td>"
							+ "<td  style=\"text-align:left;\">"+json[i]["fonoContacto"]+"</td>"
							+ "<td  style=\"text-align:center;\">"
								+ "<a href=\"/clienteModifica/"+json[i]["id"]+"\">"
									+ "<kbd style=\"background-color: #73C6B6\">E</kbd>"
								+ "</a>"
							+ "</td>"
							+ "<td  style=\"text-align:center;\">"
								+ "<a href=\"#\" onclick= \"eliminarCliente('"+json[i]["id"]+"')\">"
									+ "<kbd style=\"background-color: red\">X</kbd>"
								+ "</a>"
							+ "</td>"
						+ "</TR>";
		 			}
				tabla +=
					 "</tbody>"
						+ "</table>"
					+ "<div class=\"noprint\">"
						+ "<div class=\"row justify-content-md-center\" >"
							+ "<div class=\"col-xs-5 col-sm-2 col-md-2 col-lg-2\">"
								+ "<input type=\"button\"  value=\"AGREGAR\" class=\"btn btn-success btn-sm rounded-pill btn-block\" onclick=\"location.href='/clienteAgrega/';\">"
							+ "</div>"
							+ "<div class=\"col-xs-5 col-sm-2 col-md-2 col-lg-2\">"
								+ "<input type=\"button\"  value=\"CANCELAR\" class=\"btn btn-light btn-sm rounded-pill btn-block\" onclick=\"location.href='/home/';\">"
							+ "</div>"
						+ "</div>"
					+ "</div>";
					
				
				document.getElementById('tblPrincipal').innerHTML = tabla;
		
				$('#tablaPrincipal').DataTable({
				    	"fixedHeader": true,
						"order": [[ 2, "asc" ]],
				    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
				    	"language": {
				        	"url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
				        }
				} ).on("init.dt", function(){
					document.getElementById('enCarga').style.display="none";
				});
				
			}
			
        });
		
	}

	const eliminarCliente = (id_cliente) => {
		let nombre = $("#"+id_cliente).text();
		alertify.confirm("Esta seguro de eliminar el cliente: "+nombre, function (e) {
			if (e) {
				$("#form_id_cliente").val(id_cliente);
				document.getElementById("form_eliminar").submit();
			}
		});
	}
</script>


		
		
	
