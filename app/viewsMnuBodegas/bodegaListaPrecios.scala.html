@(mapDiccionario: Map[String,String], mapPermiso: Map[String,String], userMnu: utilities.UserMnu,
bodega: tables.BodegaEmpresa, listPrecio: List[tables.ListaPrecio], listMoneda: List[tables.Moneda], listUnidadTiempo: List[tables.UnidadTiempo])

@main("") {

	@menues(mapDiccionario, mapPermiso, userMnu, " ")
	
	@modalEquipoDescripcion()
	@modalVerCotizacion()
	
	<div id="mostrarmostrar" style="display:none;">
		@barraTitulo(mapDiccionario, "MANTENCION DE PRECIOS POR "+mapDiccionario.get("BODEGA")+"S/PROYECTOS", bodega.getNombre().toUpperCase())
		<table id="tablaPrincipal" class="table table-sm table-hover table-bordered table-condensed table-fluid">
			<thead style="background-color: #eeeeee">
				<TR> 
					<TH style="vertical-align: top;">GRUPO</TH>
					<TH>NRO.COTI</TH>
					<TH>CODIGO</TH>
					<TH>EQUIPO</TH>
					<TH>MONEDA<BR>Rep/@mapDiccionario.get("Arr")</TH>
					<TH>PRECIO<br>Reposici&oacute;n o Venta</TH>
					<TH>TASA<br>@mapDiccionario.get("Arriendo")</TH>
					<TH>PRECIO<br>@mapDiccionario.get("Arriendo")</TH>
					<TH>UNIDAD<BR>@mapDiccionario.get("Arriendo")</TH>
					<TH>VALOR<br>M&iacute;nimo</TH>
					<TH>MIN<br>D&iacute;as</TH>
				</TR>
			</thead>
			<tbody>
				@for(lista2 <- listPrecio){
					<tr class="align-middle">
						<td>@lista2.getNombreGrupo()</td>
						@if(lista2.getNumeroCotizacion()==0 || lista2.getNumeroCotizacion().equals("")){
							<td style="text-align: center;">--</td>
						}else{
							<td style="text-align: center;"><a href="#" onclick="buscaCotizacion('@lista2.getNumeroCotizacion()')">@lista2.getNumeroCotizacion()</a></td>
						}
						
						<td  style="text-align:left;"><a href="#" onclick="buscaEquipo('@lista2.getCodigoEquipo()');">@lista2.getCodigoEquipo()</a></td>
						<td  style="text-align:left;"><a href="#" onclick="buscaEquipo('@lista2.getCodigoEquipo()');">@lista2.getNombreEquipo()</a></td>
						
						<td>
							<select class="custom-select" 
								id="NM_@lista2.getId_equipo()@lista2.getId_cotizacion()" 
								onchange="grabar(id,value,'@lista2.getId_equipo()','@lista2.getId_cotizacion()')">
								<option value="@lista2.getId_moneda()">@lista2.getNickNameMoneda()</option>
								@for(lista <- listMoneda){
									<option value="@lista.id">@lista.nickName</option>
								}
							</select>
						</td>
						<td>
							<div style="display:none">@lista2.getPrecioVenta()</div>
							<input type="text" class="form-control right"
								id="PV_@lista2.getId_equipo()@lista2.getId_cotizacion()"
								value="@lista2.getPrecioVenta()"
								onfocus="value=value.replace(/,/g,'')" 
								onkeydown="return ingresoDouble(event,value)"
								onchange="grabar(id,value,'@lista2.getId_equipo()','@lista2.getId_cotizacion()')">
						</td>
						<td>
							<div style="display:none">@lista2.getTasaArriendo()</div>
							<input type="text" class="form-control center"
								id="TA_@lista2.getId_equipo()@lista2.getId_cotizacion()" 
								value="@lista2.getTasaArriendo()"
								disabled>
						</td>
						<td>
							<div style="display:none">@lista2.getPrecioArriendo()</div>
							<input type="text" class="form-control right"
								id="PA_@lista2.getId_equipo()@lista2.getId_cotizacion()"
								value="@lista2.getPrecioArriendo()"
								onfocus="value=value.replace(/,/g,'')" 
								onkeydown="return ingresoDouble(event,value)"
								onchange="grabar(id,value,'@lista2.getId_equipo()','@lista2.getId_cotizacion()')">	
						</td>
						<td>
							<select class="custom-select" 
								id="UT_@lista2.getId_equipo()@lista2.getId_cotizacion()"
								onchange="grabar(id,value,'@lista2.getId_equipo()','@lista2.getId_cotizacion()')">
								<option value="@lista2.getId_unidadTiempo()">@lista2.getNombreUnidadTiempo()</option>
								@for(lista <- listUnidadTiempo){
									<option value="@lista.id">@lista.nombre</option>
								}
							</select>
						</td>
						<td>
							<div style="display:none">@lista2.getPrecioMinimo()</div>
							<input type="text" class="form-control right"
								id="PM_@lista2.getId_equipo()@lista2.getId_cotizacion()"
								value="@lista2.getPrecioMinimo()"
								onfocus="value=value.replace(/,/g,'')" 
								onkeydown="return ingresoDouble(event,value)"
								onchange="grabar(id,value,'@lista2.getId_equipo()','@lista2.getId_cotizacion()')">
						</td>
						<td>
							<div style="display:none">@lista2.getPermanenciaMinima()</div>
							<input type="text" class="form-control right"
								id="PE_@lista2.getId_equipo()@lista2.getId_cotizacion()"
								value="@lista2.getPermanenciaMinima()"
								onfocus="value=value.replace(/,/g,'')"
								onkeydown="return ingresoDouble(event,value)"
								onchange="grabar(id,value,'@lista2.getId_equipo()','@lista2.getId_cotizacion()')">									
						</td>
					</tr>
				 }
			</tbody>
		</table>
		<div class="noprint">
			<div class="row justify-content-md-center" >
				<div class="col-xs-5 col-sm-2 col-md-2 col-lg-2">
					<input type="button"  value="LISTO" class="btn btn-success btn-sm rounded-pill btn-block" onclick="location.href='/bodegaPrecios/'">
				</div>
			</div>
		</div>
	</div>
}




<script type="text/javascript">
	$(document).ready(function() {
		  $('#tablaPrincipal').DataTable({
		    	"fixedHeader": true,
		    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
		    	"language": {
		        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
		        }
		  } );
		  document.getElementById('mostrarmostrar').style.display="block";
	});

	const grabar = (id, valor, id_equipo, id_cotizacion) => {
		let auxId = id.split("_");
		let id_moneda = $("#NM_"+auxId[1]).val();
		var formData = new FormData();
		formData.append('id_bodegaEmpresa','@bodega.getId');
		formData.append('id_equipo',id_equipo);
		formData.append('id_cotizacion',id_cotizacion);
		formData.append('id_moneda',id_moneda);
		formData.append('campo',auxId[0]);
		formData.append('valor',valor);
		$.ajax({
            url: "/actualizaListaPrecioAjax/",
            type: "POST",
            method: "POST",
            data: formData,
            cache: false,
            contentType: false,
	     	processData: false,
	     	success: function(respuesta){
	     		if(respuesta=="error"){
	     			alertify.alert(msgError, function () {
		     			location.href = "/";
		     		});
	     		}
	     		if(respuesta.status){
	     			let fecha = respuesta.fecha;
	     			let numDec = respuesta.numDec;
	     			@if(mapDiccionario.get("nEmpresa").equals("MONTAX")||mapDiccionario.get("nEmpresa").equals("TECA")) {
	     				numDec = 4;
	     			}
	     			if(auxId[0]=="PV" || auxId[0]=="PA" || auxId[0]=="PM"){
	     				$("#"+id).val(formatStandar(valor,numDec));
	     			}
	     			if(auxId[0]=="PE"){
	     				$("#"+id).val(formatStandar(valor,0));
	     			}
	     			if(auxId[0]=="PA"){
	     				let numero = new DecimalFormat("#,##0.00");
	     				let pventa = numero.formatBack($("#PV_"+auxId[1]).val());
	     				let tasa = 0;
	     				if(pventa!=0){
	     					tasa = valor/pventa*100;
	     				}
	     				$("#TA_"+auxId[1]).val(formatPorcentaje(tasa));
	     			}
	     			if(auxId[0]=="PV"){
	     				let numero = new DecimalFormat("#,##0.00");
	     				let parriendo = numero.formatBack($("#PA_"+auxId[1]).val());
	     				let tasa = 0;
	     				if(valor!=0){
	     					tasa = parriendo/valor*100;
	     				} 
	     				$("#TA_"+auxId[1]).val(formatPorcentaje(tasa));
	     			}
	     			if(auxId[0]=="NM"){
	     				let numero = new DecimalFormat("#,##0.00");
	     				let pventa = numero.formatBack($("#PV_"+auxId[1]).val());
	     				let parriendo = numero.formatBack($("#PA_"+auxId[1]).val());
	     				let pminimo = numero.formatBack($("#PM_"+auxId[1]).val());
	     				$("#PV_"+auxId[1]).val(formatStandar(pventa,numDec));
	     				$("#PA_"+auxId[1]).val(formatStandar(parriendo,numDec));
	     				$("#PM_"+auxId[1]).val(formatStandar(pminimo,numDec));
	     				
	     			}
	     			$("#FE_"+auxId[1]).val(fecha);
	     		}else{
	     			location.reload();
	     		}
	     	}
        });
	}
</script>


		
		
	
