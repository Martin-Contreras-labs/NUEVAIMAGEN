@(mapDiccionario: Map[String,String], mapPermiso: Map[String,String], userMnu: utilities.UserMnu,
fechaDesde: String, fechaHasta: String,
listActor: List[tables.MantActorPersonal], listOperMec: List[tables.MantOperadorMecanico], 
listTipoMantencion: List[tables.TipoMantencion], listEquipos: List[List[String]],
listPlanMant: List[tables.PlanMantencion])

@main("") {

	@menues(mapDiccionario, mapPermiso, userMnu, " ")
	<div id="mostrarmostrar" style="display:none;">
		@barraTitulo(mapDiccionario, "HISTORIAL DE REPORT INGRESADOS","")
		<form action="/routes3/mantHistorialReports1/" method="POST" onsubmit="return validarForm();">
			<br><br><br>
			<div class="row  justify-content-md-center">
				<div class="col-xs-11 col-sm-11 col-md-6 col-lg-6">
					<table class="table table-sm table-bordered table-condensed table-fluid">
						<thead style="background-color: #eeeeee">
							<TR>
								<TH colspan="2">PERIODO A CONSIDERAR</TH>
							</TR>
							<TR>
								<TH>FECHA DESDE:</TH>
								<td>
									<input type="date" class="form-control center"
										id="fechaDesde"
							  			name="fechaDesde"
							  			value="@fechaDesde"
					        			required>
								</td>
							</TR>
							<TR>
								<TH>FECHA HASTA:</TH>
								<td>
									<input type="date" class="form-control center"
										id="fechaHasta"
							  			name="fechaHasta"
							  			value="@fechaHasta"
					        			required>
								</td>
							</TR>
							<tr>
								<td style="text-align:left;"><strong>PERFIL:</strong></td>
						        <td style="text-align:left" width="70%" colspan="4">
						        	<select class="form-control " 
										id="id_mantActorPersonal" 
										name="id_mantActorPersonal" 
										onchange="selectPerfil(value)" 
										required>
							        		<option class="blank" value="0">-- todos --</option>
						            		@for(lista <- listActor){
						                		<option value="@lista.id">@lista.nombre.toUpperCase()</option>
											}
							        </select>
						        </td>
							</tr>
							<tr>
								<td style="text-align:left;"><strong>OPERADOR/MECANICO:</strong></td>
						        <td style="text-align:left" width="70%" colspan="4">
						        	<input type="hidden" id="id_operMec" name="id_operMec" value="0" required>
						        	<div id="nombreOperMec">
						        		<div class="input-group">
										  <input class="form-control" type="text" 
											onclick="listaOperMec()"
											value="--- todos ---" readonly>
										  <div class="input-group-append">
										    <span class="input-group-text" onclick="listaOperMec()">Buscar</span>
										  </div>
										</div> 
				    				</div>
						        </td>
							</tr>
							<tr>
								<td style="text-align:left;"><strong>TIPO DE MANTENCION (*):</strong></td>
						        <td style="text-align:left" width="70%" colspan="4">
									<div id="id_tipoMantencion">
							        	<select class="form-control " 
											id="aux_id_tipoMantencion"
											name="id_tipoMantencion"
											onchange="selectTipoMantencion()"
											required>
								        		<option class="blank" value="0">-- todos --</option>
							            		@for(lista <- listTipoMantencion){
							                		<option value="@lista.id" >@lista.nombre.toUpperCase()</option>
												}
								        </select>
									</div>
						        </td>
							</tr>
							<tr>
								<td style="text-align:left;"><strong>EQUIPO:</strong></td>
						        <td style="text-align:left" width="70%" colspan="4">
									<div id="auxModalListaEquipos">
							        	<input type="hidden" id="id_equipo" name="id_equipo" value="0">
							        	<div id="nombreEquipo">
							        		<div class="input-group ">
											  <input class="form-control" type="text" 
												onclick="listaEquipo();" 
												id="valNomEquip"
												value="--- todos ---" readonly>
											  <div class="input-group-append">
											    <span class="input-group-text" onclick="listaEquipo();">Buscar</span>
											  </div>
											</div> 
					    				</div>
									</div>
						        </td>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
			<div class="row  justify-content-md-center">
				<div class="col-xs-4 col-sm-2 col-md-2 col-lg-2">
					<input type="submit" value='Generar Reporte' class="btn btn-primary btn-sm rounded-pill btn-block">
				</div>
			</div>
		</form>
		
		
		
		
		<div id="modalListaALL" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title">Seleccionar operador</h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
					<table id="tablaOperMec" class="table table-sm table-bordered table-condensed table-hover table-fluid">
				        <thead style="background-color: #eeeeee">
							<TR> 
								<th>RUT</th>
								<th>Operador/Mecanico</th>
								<th>Origen/Tipo</th>
							</TR>
						</thead>
						<tbody>
							@for(lista <- listOperMec){
								<TR onclick="selectOperMec('@lista.getId()', btoa('@lista.getNombre()'), btoa('@lista.getNameTipoPersonal()') )">
									<td style="text-align:left"><a href="#">@lista.getRut()</a></td>	
									<td style="text-align:left"><a href="#">@lista.getNombre()</a></td>
									<td style="text-align:left"><a href="#">@lista.getNameTipoPersonal()</a></td>
								</TR>
							}
						</tbody>
					</table>
			        <br>
					<div align="center">
			           	<button type="button" class="btn btn-sm btn-success" data-dismiss="modal" style="font-size: 10px;">CERRAR</button>
				    </div>
			      </div>
			    </div>
			 </div>
		</div>
	
		<div id="modalListaOperadores" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title">Seleccionar operador</h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
					<table id="tablaOperadores" class="table table-sm table-bordered table-condensed table-hover table-fluid">
				        <thead style="background-color: #eeeeee">
							<TR> 
								<th>RUT</th>
								<th>Operador</th>
								<th>Origen/Tipo</th>
							</TR>
						</thead>
						<tbody>
							@for(lista <- listOperMec){
								@if(lista.getId_mantActorPersonal() == 1){
									<TR onclick="selectOperMec('@lista.getId()', btoa('@lista.getNombre()'), btoa('@lista.getNameTipoPersonal()') )">
										<td style="text-align:left"><a href="#">@lista.getRut()</a></td>	
										<td style="text-align:left"><a href="#">@lista.getNombre()</a></td>
										<td style="text-align:left"><a href="#">@lista.getNameTipoPersonal()</a></td>
									</TR>
								}
								
							}
						</tbody>
					</table>
			        <br>
					<div align="center">
			           	<button type="button" class="btn btn-sm btn-success" data-dismiss="modal" style="font-size: 10px;">CERRAR</button>
				    </div>
			      </div>
			    </div>
			 </div>
		</div>
	
		<div id="modalListaMecanicos" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title">Seleccionar mecanico</h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
					<table id="tablaMecanicos" class="table table-sm table-bordered table-condensed table-hover table-fluid">
				        <thead style="background-color: #eeeeee">
							<TR> 
								<th>RUT</th>
								<th>Mecanico</th>
								<th>Origen/Tipo</th>
							</TR>
						</thead>
						<tbody>
							@for(lista <- listOperMec){
								@if(lista.getId_mantActorPersonal() == 2){
									<TR onclick="selectOperMec('@lista.getId()', btoa('@lista.getNombre()'), btoa('@lista.getNameTipoPersonal()') )">
										<td style="text-align:left"><a href="#">@lista.getRut()</a></td>	
										<td style="text-align:left"><a href="#">@lista.getNombre()</a></td>
										<td style="text-align:left"><a href="#">@lista.getNameTipoPersonal()</a></td>
									</TR>
								}
							}
						</tbody>
					</table>
			        <br>
					<div align="center">
			           	<button type="button" class="btn btn-sm btn-success" data-dismiss="modal" style="font-size: 10px;">CERRAR</button>
				    </div>
			      </div>
			    </div>
			 </div>
		</div>
		
		<div id="modalListaEquipos_oper" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title">Seleccionar </h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
					<table id="tablaEquipos_oper" class="table table-sm table-bordered table-condensed table-hover table-fluid">
				        <thead style="background-color: #eeeeee">
							<TR> 
								<th>GRUPO</th>
								<th>CODIGO</th>
								<th>EQUIPO</th>
							</TR>
						</thead>
						<tbody>
							@for(lista <- listEquipos){
								<TR onclick="selectEquipo(
										'@lista.get(0)', 
										btoa('@lista.get(2)'), 
										btoa('@lista.get(3)'),
										0)">
									<td style="text-align:left"><a href="#">@lista.get(1)</a></td>	
									<td style="text-align:left"><a href="#">@lista.get(2)</a></td>
									<td style="text-align:left"><a href="#">@lista.get(3)</a></td>
								</TR>
							}
						</tbody>
					</table>
					<div align="center">
			           	<button type="button" class="btn btn-sm btn-success" data-dismiss="modal" style="font-size: 10px;">CERRAR</button>
				    </div>
			      </div>
			    </div>
			 </div>
		</div>
		
		<div id="modalListaEquipos_mec" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title">Seleccionar </h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
					<table id="tablaEquipos_mec" class="table table-sm table-bordered table-condensed table-hover table-fluid">
				        <thead style="background-color: #eeeeee">
							<TR> 
								<th>GRUPO</th>
								<th>CODIGO</th>
								<th>EQUIPO</th>
								<th>TIPO PLAN</th>
							</TR>
						</thead>
						<tbody>
							@for(lista <- listPlanMant){
								<TR onclick="selectEquipo(
										'@lista.getId_equipo()', 
										btoa('@lista.getEquipoCodigo()'), 
										btoa('@lista.getEquipoNombre()'),
										btoa('@lista.getTipoPlanNombre()'))">
									<td style="text-align:left"><a href="#">@lista.getEquipoGrupo()</a></td>	
									<td style="text-align:left"><a href="#">@lista.getEquipoCodigo()</a></td>
									<td style="text-align:left"><a href="#">@lista.getEquipoNombre()</a></td>
									<td style="text-align:left"><a href="#">@lista.getTipoPlanNombre()</a></td>
								</TR>
							}
						</tbody>
					</table>
					<div align="center">
			           	<button type="button" class="btn btn-sm btn-success" data-dismiss="modal" style="font-size: 10px;">CERRAR</button>
				    </div>
			      </div>
			    </div>
			 </div>
		</div>
	
	</div>

}


<script type="text/javascript">
	let auxId_tipoMantencion = "";
	let auxModalListaEquipos = "";
	$(document).ready(function() {
		
		$('#tablaOperMec').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": false,
	    	"paging":   false,
	        "ordering": [['1','asc']],
	        "info":     false,
			"searching": true,
	    	"language": {
	        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
	        }
	    } );
		$('#tablaOperadores').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": false,
	    	"paging":   false,
	        "ordering": [['1','asc']],
	        "info":     false,
			"searching": true,
	    	"language": {
	        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
	        }
	    } );
		$('#tablaMecanicos').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": false,
	    	"paging":   false,
	        "ordering": [['1','asc']],
	        "info":     false,
			"searching": true,
	    	"language": {
	        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
	        }
	    } );
		$('#tablaEquipos_oper').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": false,
	    	"paging":   false,
	        "ordering": [['1','asc']],
	        "info":     false,
			"searching": true,
	    	"language": {
	        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
	        }
	    } );
		$('#tablaEquipos_mec').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": false,
	    	"paging":   false,
	        "ordering": [['1','asc']],
	        "info":     false,
			"searching": true,
	    	"language": {
	        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
	        }
	    } );

			auxId_tipoMantencion = document.getElementById("id_tipoMantencion").innerHTML;
			auxModalListaEquipos = document.getElementById("auxModalListaEquipos").innerHTML;
		  	document.getElementById('mostrarmostrar').style.display="block";
	});
	
	const validarForm = () =>{
		let flag = true;
		var desde = Date.parse(document.getElementById('fechaDesde').value);
		var hasta = Date.parse(document.getElementById('fechaHasta').value);
		let diffDias = Math.floor((hasta - desde)/(1000 * 60 * 60 * 24))+1;
		if(desde > hasta){
			flag = false;
			alertify.alert('LA FECHA INICIAL NO PUEDE SER MAYOR A LA FECHA FINAL', function () {
				return(flag);
     		});
		}
		
		if(diffDias > 92){
			flag = false;
			alertify.alert('EL PERIODO NO PUEDE SER MAYOR A 92 DIAS', function () {
				return(flag);
     		});
		}
		return(flag);
	}
	
	const listaOperMec = () =>{
		if($('#id_mantActorPersonal').val() == 0){
			$('#modalListaALL').modal('show');
		}else if($('#id_mantActorPersonal').val() == 1){
			$('#modalListaOperadores').modal('show'); 
		}else if($('#id_mantActorPersonal').val() == 2){
			$('#modalListaMecanicos').modal('show'); 
		}
		
	}
	
	const listaEquipo = () =>{
		if($('#id_mantActorPersonal').val() == 2 && $('#aux_id_tipoMantencion').val() == 1){
			$('#modalListaEquipos_mec').modal('show'); 
		}else{
			$('#modalListaEquipos_oper').modal('show');
		}
	}
	
	const selectTipoMantencion = () =>{
		document.getElementById("auxModalListaEquipos").innerHTML = auxModalListaEquipos;
	}
	
	
	
	const selectPerfil = (id_perfil) =>{
		$('#id_operMec').val(0);
		document.getElementById("nombreOperMec").innerHTML=
			"<div class='input-group '>"+
			  "<input class='form-control' type='text' onclick=\"listaOperMec()\" "+
					" value='--- todos ---' readonly>"+
			  "<div class='input-group-append'>"+
			    "<span class='input-group-text' onclick=\"listaOperMec()\">Buscar</span>"+
			  "</div>"+
			"</div>";
			
			if(id_perfil == 1){
				document.getElementById("id_tipoMantencion").innerHTML= 
					"<select class=\"form-control \" "+
						" name=\"id_tipoMantencion\">"+
						" <option class=\"blank\" value=\"0\">NO APLICA</option>"+
						" </select>"
			}else{
				document.getElementById("id_tipoMantencion").innerHTML= auxId_tipoMantencion;
			}
			document.getElementById("auxModalListaEquipos").innerHTML = auxModalListaEquipos;
	}
	
	const selectOperMec = (id_operMec, operador, tipo) =>{
		operador = atob(operador);
		tipo = atob(tipo);
		$('#id_operMec').val(id_operMec);
		document.getElementById("nombreOperMec").innerHTML=
			"<div class='input-group'>"+
			  "<input class='form-control' type='text' onclick=\"$('#modalListaOperadores').modal('show');\" "+
					" value='"+operador+"' readonly>"+
			  "<div class='input-group-append'>"+
			    "<span class='input-group-text' onclick=\"$('#modalListaOperadores').modal('show');\">Buscar</span>"+
			  "</div>"+
			"</div>";
		$('#modalListaALL').modal('hide');
		$('#modalListaOperadores').modal('hide');
		$('#modalListaMecanicos').modal('hide');
	}
	
	const selectEquipo = (id_equipo, codigo, equipo, tipoPlanNombre) =>{
		codigo = atob(codigo);
		equipo = atob(equipo);
		if(tipoPlanNombre != 0){
			tipoPlanNombre = " ("+atob(tipoPlanNombre)+")";
		}else{
			tipoPlanNombre = "";
		}
		
		$('#id_equipo').val(id_equipo);
		
		document.getElementById("nombreEquipo").innerHTML=
			"<div class='input-group '>"+
			  "<input class='form-control' type='text' onclick=\"listaEquipo();\" "+
				" id=\"valNomEquip_oper\" value='"+codigo+" - "+equipo+tipoPlanNombre+"' readonly>"+
			  "<div class='input-group-append'>"+
			    "<span class='input-group-text' onclick=\"listaEquipo();\">Buscar</span>"+
			  "</div>"+
			"</div>";
		$('#modalListaEquipos_oper').modal('hide');
		$('#modalListaEquipos_mec').modal('hide');
			
	}
	
	
</script>




		
		
	
