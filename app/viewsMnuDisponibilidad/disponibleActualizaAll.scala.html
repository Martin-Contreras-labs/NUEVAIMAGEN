@(mapDiccionario: Map[String,String], mapPermiso: Map[String,String], userMnu: utilities.UserMnu,
listaDisponibilidad: List[tables.Cronograma])

    	
@main("") {

	@menues(mapDiccionario, mapPermiso, userMnu, " ")
	<div id="mostrarmostrar" style="display:none;">
		@barraTitulo(mapDiccionario, "DISPONIBILIDAD DE EQUIPOS EN "+mapDiccionario.get("BODEGAS")+"/PROYECTOS","")
		<div class="row  justify-content-md-center">
			<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
				<table id="tablaPrincipal" class="table table-sm table-hover table-bordered table-condensed table-fluid">
					<thead style="background-color: #eeeeee">
						<TR>
							<TH>SUCURSAL</TH>
							<TH>@mapDiccionario.get("BODEGA")/PROYECTO</TH>
							<TH>GRUPO/FAMILIA</TH>
							<TH>CODIGO</TH>
							<TH>EQUIPO</TH>
							<TH>UN</TH>
							<TH>CANT</TH>
							<TH>EN PROYECTO DESDE</TH>
							<TH>ULTIMA MODIFICACION</TH>
							<TH>DISPONIBLE A PARTIR DE</TH>
						</TR>
					</thead>
					<tbody>
						@for(lista1 <- listaDisponibilidad){
							<TR>
								<TD style= "text-align: left;">@lista1.nameSucursal</TD>
								<TD style= "text-align: left;">@lista1.nombreBodega</TD>
								<TD style= "text-align: left;">@lista1.nombreGrupo</TD>
								<TD style= "text-align: left;">@lista1.codEquipo</TD>
								<TD style= "text-align: left;">@lista1.nombreEquipo</TD>
								<TD style= "text-align: center;">@lista1.unidad</TD>
								<TD style= "text-align: right;">@lista1.cantidad</TD>
								<TD style= "text-align: center;">@lista1.fechaDesde</TD>
								
								<TD style= "text-align: center;">
									<div id="hoy@lista1.id_movimiento">@lista1.fechaActualizacion</div>
								</TD>
								
								<TD style= "text-align: center;">
									
									@if(lista1.fechaDisponible.equals("No Informada")){
										<div id="@lista1.id_movimiento @lista1.id_bodegaEmpresa">
											<input type="text" class="form-control center"
												value="@lista1.fechaDisponible" 
												onclick="noInforma('@lista1.id_movimiento','@lista1.id_bodegaEmpresa','@lista1.id_equipo')">
										</div>
									}else {
										<input type="date" class="form-control center"
											onfocus="fechaAux = value"
								  			onblur="if(!limitaFecha(value, 720, 1440)) {
														value='@utilities.Fechas.AAMMDD(lista1.fechaDisponible)';
													} else if(fechaAux != value){
														actualizaFecha('@lista1.id_movimiento','@lista1.id_bodegaEmpresa','@lista1.id_equipo',value)
													}"
								  			value="@utilities.Fechas.AAMMDD(lista1.fechaDisponible)">
									}
								</TD>
							</TR>
			 			}
					</tbody>
				</table>
			</div>
		</div>
		<div class="noprint">
			<div class="row justify-content-md-center" >
				<div class="col-xs-5 col-sm-2 col-md-2 col-lg-2">
					<input type="button"  value="LISTO" class="btn btn-success btn-sm rounded-pill btn-block" onclick="location.href='/home/';">
				</div>
			</div>
		</div>
	</div>

}


<script type="text/javascript">
	let fechaAux = "";
	$(document).ready(function() {
		  $('#tablaPrincipal').DataTable({
		    	"fixedHeader": true,
		    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
		    	"order": [[ 2, "asc" ],[ 4, "asc" ],[ 1, "asc" ]],
		    	"language": {
		        	"url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
		        }
		  } );
		  document.getElementById('mostrarmostrar').style.display="block";
	});
	
	const actualizaFecha = (id_movimiento,id_bodega,id_equipo,fecha) =>{
		var formData = new FormData();
	  	formData.append('id_movimiento',id_movimiento);
		formData.append('id_bodega',id_bodega);
		formData.append('id_equipo',id_equipo);
		formData.append('fecha',fecha);
        $.ajax({
            url: "/cambiaFechaDisponibleAjax/",
            type: "POST",
            method: "POST",
            data: formData,
            cache: false,
            contentType: false,
	     	processData: false,
	     	success: function(rs){
				document.getElementById("hoy"+id_movimiento).innerHTML = rs;
	     	}
        });
	}
	
	const noInforma = (id_movimiento,id_bodega,id_equipo) =>{
		document.getElementById(id_movimiento+" "+id_bodega).innerHTML =
			"<input type='date' class='form-control center' " +
				" onfocus='fechaAux = value' "+
				" onblur='if(!limitaFecha(value, 720, 1440)) { value=\"\";} else if(fechaAux != value){actualizaFecha("+id_movimiento+","+id_bodega+","+id_equipo+",value);}'>";
	}
		
	
	
	
</script>




		
		
	
