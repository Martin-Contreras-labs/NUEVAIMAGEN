@(mapDiccionario: Map[String,String], mapPermiso: Map[String,String], userMnu: utilities.UserMnu,
factura: xml.FormXmlFactura, id_proforma: Long, listTipoReferencias: List[tables.TipoReferencia], mapReferencia: Map[String,String])


@main("") {

	@menues(mapDiccionario, mapPermiso, userMnu, " ")
	<div id="mostrarmostrar" style="display:none;">
		@barraTitulo(mapDiccionario, "PROFORMA FACTURA XML","COMPLETAR O MODIFICAR REFERENCIAS Y COMENTARIOS")

		<form class="formulario" method="post" action="/sendXMLFacura/@id_proforma">
			<div class="container">
				<table id="receptor" class="table table-sm table-hover table-bordered table-condensed table-fluid">
				 	<tr>
				 		<td colspan="4">DATOS RECEPTOR:</td>
				 	</tr>
				 	<tr>
				 		<td>@mapDiccionario("RUT"):</td>
				 		<td>@factura.rutRecep</td>
				 		<td>Dirección:</td>
				 		<td>@factura.dirRecep</td>
				 	</tr>
				 	<tr>
				 		<td>Razón Social:</td>
				 		<td>@factura.rznSocRecep</td>
				 		<td>@mapDiccionario.get("Comuna"):</td>
				 		<td>@factura.cmnaRecep</td>
				 	</tr>
				 	<tr>
				 		<td>Giro:</td>
				 		<td>@factura.giroRecep</td>
				 		<td>Ciudad:</td>
				 		<td>@factura.ciudadRecep</td>
				 	</tr>
				 	<tr>
				 		<td>Contacto:</td>
				 		<td>@factura.contacto</td>
				 		<td>Correo:</td>
				 		<td>@factura.correoRecep</td>
				 	</tr>
				</table>
				
				<table id="detalle" class="table table-sm table-hover table-bordered table-condensed table-fluid">
				 	<tr>
				 		<td colspan="7">DETALLE:</td>
				 	</tr>
				 	<tr>
				 		<td>NroLinDet</td>
				 		<td>TpoCodigo</td>
				 		<td>VlrCodigo</td>
				 		<td>NmbItem</td>
				 		<td>QtyItem</td>
				 		<td>UnmdItem</td>
				 		<td>PrcItem</td>
				 		<td>MontoItem</td>
				 	</tr>
					 	@for(lista <- factura.nroLinDet){
						 	<tr>
						 		<td>@lista</td>
						 		<td>@factura.tpoCodigo.get(Integer.parseInt(lista)-1)</td>
						 		<td>@factura.vlrCodigo.get(Integer.parseInt(lista)-1)</td>
						 		<td>@factura.nmbItem.get(Integer.parseInt(lista)-1)</td>
						 		<td>@factura.qtyItem.get(Integer.parseInt(lista)-1)</td>
						 		<td>@factura.unmdItem.get(Integer.parseInt(lista)-1)</td>
						 		<td>@factura.prcItem.get(Integer.parseInt(lista)-1)</td>
						 		<td>@factura.montoItem.get(Integer.parseInt(lista)-1)</td>
						 	</tr>
					 	}
				 	<tr>
				 		<td colspan="5"></td>
				 		<td colspan="2">NETO</td>
				 		<td>@factura.mntNeto</td>
				 	</tr>
				 	<tr>
				 		<td colspan="5"></td>
				 		<td colspan="2">IVA</td>
				 		<td>@factura.iva</td>
				 	</tr>
				 	<tr>
				 		<td colspan="5"></td>
				 		<td colspan="2">TOTAL</td>
				 		<td>@factura.mntTotal</td>
				 	</tr>
				</table>
				
				<table id="referencia" class="table table-sm table-hover table-bordered table-condensed table-fluid">
				 	<tr>
				 		<td colspan="4">REFERENCIAS:</td>
				 		<td colspan="1">
				 			<div align="right">
				 				<a  class="btn btn-warning btn-mini" onclick="agregarReferencia()">agregar referencia</a>
				 			</div>
				 		</td>
				 	</tr>
				 	<tr>
				 		<td>NroLinRef</td>
				 		<td>TpoDocRef</td>
				 		<td>FolioRef</td>
				 		<td>FchRef</td>
				 		<td>RazonRef</td>
				 	</tr>
				 	@if(factura.nroLinRef!=null){
					 	@for(lista <- factura.nroLinRef){
						 	<tr>
						 		<td>@lista
						 			<input type="hidden" name="nroLinRef[]" value="@lista">
						 		</td>
						 		<td>
							 		<select name='tpoDocRef[]' onchange="verificaReferencia(value,this)">
								
										<option value="@factura.tpoDocRef.get(Integer.parseInt(lista)-1)">
											@if(mapReferencia.get(factura.tpoDocRef.get(Integer.parseInt(lista)-1)) != null ){
												@mapReferencia.get(factura.tpoDocRef.get(Integer.parseInt(lista)-1))
											}
										</option>
										@for(referencia <- listTipoReferencias){
											<option value="@referencia.codigo">@referencia.concepto</option>
										} 
										
										
									</select>
						 		</td>
						 		<td>
						 			<input type="text" name="folioRef[]" value="@factura.folioRef.get(Integer.parseInt(lista)-1)">
						 		</td>
						 		<td>
						 			<input type="date" name="fchRef[]" value="@factura.fchRef.get(Integer.parseInt(lista)-1)">
						 		</td>
						 		<td>
						 			<input type="text" name="razonRef[]" value="@factura.razonRef.get(Integer.parseInt(lista)-1)">
						 		</td>
						 	</tr>
					 	}
				 	}
				 </table>
				 
				 	<script>
					 	function verificaReferencia(value,select){
					 		if(value==0){
					 			select.parentNode.parentNode.remove();
					 			var tabla = document.getElementById('referencia');
					 			
					 			for (var i = 2; i < tabla.rows.length; i++){
					 				var cellsOfRow = tabla.rows[i].getElementsByTagName('td');
					 				cellsOfRow[0].innerHTML=i-1;
					 			}
					 		
					 			
					 		}
					 	}
				 		function agregarReferencia(){
				 			var tabla = document.getElementById('referencia');
							var row = tabla.insertRow(tabla.rows.length);
							
							var cell=row.insertCell(0);
							var indice = tabla.rows.length-2;
							cell.innerHTML=indice+"<input type='hidden' name='nroLinRef[]' value='"+indice+"'>";
							
							cell=row.insertCell(1);
							var listado = "<select name='tpoDocRef[]'>";
							@for(referencia <- listTipoReferencias){
								listado = listado + "<option value='@referencia.codigo'>@referencia.concepto</option>";
							}
							listado = listado + "</select>";
							cell.innerHTML=listado;
							
							cell=row.insertCell(2);
							cell.innerHTML="<input type='text' name='folioRef[]' value=''>";
							
							cell=row.insertCell(3);
							cell.innerHTML="<input type='date' name='fchRef[]' value=''>";
							
							cell=row.insertCell(4);
							cell.innerHTML="<input type='text' name='razonRef[]' value=''>";
							
				 		}
				 	</script>
				
				<table id="comentarios" class="table table-sm table-hover table-bordered table-condensed table-fluid">
				 	<tr>
				 		<td>COMENTARIOS:</td>
				 	</tr>
				 	<tr>
				 		<td>
				 		<textarea rows="2" style="width:100%" name="obs">@factura.obs</textarea></td>
				 	</tr>
				</table>
				
				<button type='submit'>ENVIAR</button>
				
				
			</div>
	</form>

}
													
<script type="text/javascript">

	$(document).ready(function() {
		document.getElementById('mostrarmostrar').style.display="block";
	});
	
</script>
				

