@(mapDiccionario: Map[String,String], mapPermiso: Map[String,String], userMnu: utilities.UserMnu,
formOt: forms.FormOt, listBodegas: List[List[String]], tabla: String, listProyectos: List[tables.Proyecto], listRegiones: List[tables.Regiones])

@main("") {

	@menues(mapDiccionario, mapPermiso, userMnu, " ")
	
		
		<!-- MODAL CREA PROYECTOS -->
			@modalProyectoNuevo(mapDiccionario, listRegiones)
			<script>
				const proyectoGrabaAjax = (id_proyecto) =>{
					$('#id_proyecto').val(id_proyecto);
					$('#nombreProyecto').val($("#proyectoNickName").val());
					let tabla = document.getElementById('tablaListaProyectos');
					let row = tabla.insertRow(tabla.rows.length);
					let cell = row.insertCell(0);
					cell.style.textAlign = "left";
					cell.innerHTML = $("#proyectoNickName").val();
					cell = row.insertCell(1);
					cell.style.textAlign = "left";
					cell.innerHTML = $("#proyectoNombre").val();
					row.setAttribute("onClick", "selectProyecto('" + id_proyecto + "')");
					row.setAttribute("data-dismiss", "modal");
					$("#id_proyecto").val(id_proyecto);
					$("#nickProyecto").val($("#proyectoNickName").val());
				}
			</script>
		<!-- FIN MODAL CREA PROYECTOS -->
		

		<div id="mostrarmostrar" style="display:none;">
			@barraTitulo(mapDiccionario, "COTIZACION PARA EMITIR "+mapDiccionario.get("ORDEN_DE_TRABAJO"), "")
			<form action="/otGrabar/" enctype="multipart/form-data" method="POST" onsubmit="return validarForm();">
				<h6>@mapDiccionario.get("ORDEN_DE_TRABAJO"):</h6>
				<div class="row  justify-content-md-center">
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
						<table class="table table-sm table-hover table-bordered table-condensed table-fluid">
							<thead style="background-color: #eeeeee">
								<tr>
									<td width="18%">
										<input type="hidden" id="id_ot" name="id_ot" value="@formOt.id_ot">
										<input type="hidden" id="id_cotizacion" name="id_cotizacion" value="@formOt.id_cotizacion">
										<div class="input-group">
									  		<div class="input-group-prepend">
									    		<span class="input-group-text" id="basic-addon1">Nro. @mapDiccionario.get("Orden_de_trabajo")</span>
									  		</div>
									  		<input type="text" class="form-control center"
									  				name="numeroOt"
													value = "@formOt.numeroOt"
													readonly>
										</div>
									</td>
									<td width="18%">
										<div class="input-group">
									  		<div class="input-group-prepend">
									    		<span class="input-group-text" id="basic-addon1">Fecha</span>
									  		</div>
									  		<input type="date" class="form-control center"
									  			name="fechaOt" 
									  			id="fechaOt"
									  			onblur="if(!limitaFecha(value,720,10)) value='@formOt.fechaOt';"
									  			value="@formOt.fechaOt"
							        			required>
										</div>
									</td>
									<td width="32%">
										<input type="hidden" id="id_bodegaEmpresa" name="id_bodegaEmpresa" value="@formOt.id_bodegaEmpresa">
										<div class="input-group">
									  		<div class="input-group-prepend">
									    		<span class="input-group-text" id="basic-addon1">@mapDiccionario.get("BODEGA")/PROYECTO</span>
									  		</div>
											@if(formOt.id_bodegaEmpresa > 0) {
										  		<input type="text" class="form-control left"
														value = "@formOt.nombreBodega"
														readonly>
											}else{
												<input type="text" class="form-control"
			  										id="nombreBodega"
			  										value="" 
			  										style="background:white"
			  										onclick="$('#listaBodega').modal('show');"
			  										readonly>
											}
										</div>
									</td>
									
									
									<td width="32%">
										<input type="hidden" id="id_proyecto" name="id_proyecto" value="@formOt.id_proyecto">
										<div class="input-group">
									  		<div class="input-group-prepend">
									    		<span class="input-group-text" id="basic-addon1">NOMBRE PROYECTO</span>
									  		</div>
											<input type="text" class="form-control"
		  										id="nickProyecto"
		  										value="@formOt.nickProyecto" 
		  										style="background:white"
		  										onclick="$('#listaProyecto').modal('show');"
		  										readonly>
										</div>
									</td>
									
									<td align="center">
										<span class="btn btn-info btn-sm btn-file" style="font-size: 8px;">
											<div id="txtBtn">Adjuntar</div>
					    					<input type="file" id="docAdjunto" name="docAdjunto" onchange="LimitAttach(this.form, this.form.docAdjunto.value);">
										</span>
									</td>
								</tr>
								<tr>
									<td width="30%">
										<div class="input-group">
									  		<div class="input-group-prepend">
									    		<span class="input-group-text" id="basic-addon1">Fecha Entrega</span>
									  		</div>
											<input type="date" class="form-control center"
									  			name="fechaEnvio" 
									  			onblur="if(!limitaFecha(value,30,360)) value='';">
											
										</div>
									</td>
									<td colspan="20">
										<div class="input-group">
									  		<div class="input-group-prepend">
									    		<span class="input-group-text" id="basic-addon1">Observaciones</span>
									  		</div>
		  									<textarea class="form-control" 
		  										name="observaciones" 
		  										autocomplete="off">@formOt.observaciones</textarea>
										</div>
									</td>
								</tr>
							</thead>
						</table>
					</div>
				</div>
				<hr>
				<h6>COTIZACION:</h6>
				<div class="row  justify-content-md-center">
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
						@Html(tabla)
					</div>
				</div>
				
				<div class="noprint" align="left">
					<div class="row justify-content-md-center" >
						<div class="col-xs-5 col-sm-1 col-md-1 col-lg-1">
							<input type="button"  value="Cancelar" class="btn btn-light btn-sm rounded-pill btn-block" onclick="location.href='/home/';">
						</div>
						<div class="col-xs-5 col-sm-1 col-md-1 col-lg-1">
							<input type="submit"  id="aplica" value='GENERAR @mapDiccionario.get("OT")' class="btn btn-success btn-sm rounded-pill btn-block">
						</div>
					</div>
				</div>
			</form>
		</div>
		
		<div id='listaBodega' class='modal' role='dialog' data-backdrop='static' data-keyboard='false'>
			<div class='modal-dialog modal-dialog-scrollable modal-lg' role='document'>
				<div class='modal-content'>
					<div class='modal-header'>
						<h5 class='modal-title'>SELECCIONAR @mapDiccionario.get("BODEGA")/PROYECTO</h5>
					        <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
					          <span aria-hidden='true'>&times;</span>
					        </button>
					</div>
					<div class='modal-body'>
						<table id="tablaListaBodegas" class='table table-sm table-bordered table-condensed table-hover table-fluid'>
							<thead style="background-color: #eeeeee">
								<TR>
									<TH>SUCURSAL</TH>
									<TH>@mapDiccionario.get("BODEGA")/PROYECTO</TH>
									<TH>CLIENTE</TH>
							        <TH>PROYECTO</TH>
								</TR>
							</thead>
							<tbody>
								@for(lista1 <- listBodegas){
									<TR onclick="selectBodega(@lista1.get(1))">
										<td  style="text-align:left;">@lista1.get(16)</td>
										<td  style="text-align:left;"><div id="bodega_@lista1.get(1)">@lista1.get(5)</div></td>
										<td  style="text-align:left;">@lista1.get(7)</td>
										<td  style="text-align:left;">@lista1.get(8)</td>
									</TR>
					 			}
							</tbody>
						</table>
		   				<div class='row'>
							<div class='col-sm-12' style='text-align:center'>
								<button type='button' class='btn btn-sm  btn-warning' style='font-size: 10px;' data-dismiss='modal'>Cancelar</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div id='listaProyecto' class='modal' role='dialog' data-backdrop='static' data-keyboard='false'>
			<div class='modal-dialog modal-dialog-scrollable modal-lg' role='document'>
				<div class='modal-content'>
					<div class='modal-header'>
						<h5 class='modal-title'>SELECCIONAR PROYECTO</h5>
					        <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
					          <span aria-hidden='true'>&times;</span>
					        </button>
					</div>
					<div class='modal-body'>
						<div class="noprint" align="center">
							<a href="#" onclick="$('#listaProyecto').modal('hide'); $('#modalProyectoNuevo').modal('show');">
								<kbd style="background-color: #73C6B6">Agregar Nuevo</kbd>
							</a>
						</div>
						<table id="tablaListaProyectos" class='table table-sm table-bordered table-condensed table-hover table-fluid'>
							<thead style="background-color: #eeeeee">
								<TR>
									<TH>NOMBRE CORTO</TH>
									<TH>NOMBRE LARGO</TH>
								</TR>
							</thead>
							<tbody>
								@for(lista1 <- listProyectos){
									<TR onclick="selectProyecto(@lista1.id)">
										<td  style="text-align:left;"><div id="proyecto_@lista1.id">@lista1.nickName</div></td>
										<td  style="text-align:left;">@lista1.nombre</td>
									</TR>
					 			}
							</tbody>
						</table>
		   				<div class='row'>
							<div class='col-sm-12' style='text-align:center'>
								<button type='button' class='btn btn-sm  btn-warning' style='font-size: 10px;' data-dismiss='modal'>Cancelar</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		

		
		
	
	
}



<script type="text/javascript">

	$(document).ready(function() {
		
		$('#tablaListaBodegas').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
	    	"order": [[ 1, "asc" ]],
	    	"language": {
	        	"url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
	        }
	  	} );

		$('#tablaListaProyectos').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
	    	"order": [[ 0, "asc" ]],
	    	"language": {
	        	"url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
	        }
	  	} );

		document.getElementById('mostrarmostrar').style.display="block";
	});
	
	const selectBodega = (id_bodega) =>{
		$("#id_bodegaEmpresa").val(id_bodega);
		$("#nombreBodega").val($("#bodega_"+id_bodega).text());
		$('#listaBodega').modal('hide');
	}
	
	const selectProyecto = (id_proyecto) =>{
		$("#id_proyecto").val(id_proyecto);
		$("#nickProyecto").val($("#proyecto_"+id_proyecto).text());
		$('#listaProyecto').modal('hide');
	}
	
	const validarForm = () =>{
		$("#aplica").attr('disabled',true);
		let flag = true;
		let id_bodegaEmpresa = $("#id_bodegaEmpresa").val();
		if(id_bodegaEmpresa == 0){
			flag = false;
			alertify.alert('DEBE ASOCIAR LA ORDEN A @mapDiccionario.get("BODEGA")/PROYECTO', function () {
				document.getElementById("nombreBodega").focus();
				$("#aplica").attr('disabled',false);
				return(flag);
     		});
		}
		return(flag);
	}
	
	let extArray = new Array(".gif", ".jpg", ".png", ".jpeg", ".pdf", ".xls", ".doc", ".xlsx", ".docx", ".tar", ".zip", ".rar");
	const LimitAttach = (form, file) => {
		let allowSubmit = false;
		if (!file) return;
		while (file.indexOf("\\") != -1){
			file = file.slice(file.indexOf("\\") + 1);
		}
		let extencion = file.slice(file.lastIndexOf(".")).toLowerCase();
		for (var i = 0; i < extArray.length; i++) {
			if (extArray[i] == extencion) { allowSubmit = true; break; }
		}
		if (allowSubmit) {
			var file = $("#docAdjunto")[0].files[0];
			var fileSize = file.size; //tamaño del archivo
			if(fileSize>100000000){
				alert("Se permiten únicamente archivos que no superen los 100 MB,"
				+" el que se intenta subir pesa: "+Math.round(file.size/10)/100+" KB");
				form.docAdjunto.value="";
			}else{
				alert("Documento subido con éxito");
				$("#txtBtn").text("Cambiar Documento");
			}
		}else{
			alert("Se permiten únicamente archivos con la extención: " 
			+ (extArray.join("  ")) + "\nPor favor, seleccione otro archivo "
			+ "e intente de nuevo.");
			form.docAdjunto.value="";
		}
	}
	

	
</script>


		
		
	
