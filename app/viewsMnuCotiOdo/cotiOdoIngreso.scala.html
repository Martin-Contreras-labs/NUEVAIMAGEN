@(mapDiccionario: Map[String,String], mapPermiso: Map[String,String], userMnu: utilities.UserMnu,
		listClientes: List[tables.Cliente], listProyectos: List[tables.Proyecto], listRegiones: List[tables.Regiones],
		formCotizaOdo: forms.FormCotizaOdo, listadoServicios: List[List[String]], listCotiOdo: List[List[String]], numDec: Long,
		listEquipos: List[tables.Equipo])

@main("") {

@menues(mapDiccionario, mapPermiso, userMnu, " ")

	@modalEquipoDescripcion()

	<!-- MODAL CREA CLIENTES -->
		@modalClienteNuevo(mapDiccionario, listRegiones)
		<script>
			const clienteGrabaAjax = (id_cliente) =>{
				$('#id_cliente').val(id_cliente);
				$('#rutCliente').val($("#clienteRut").val());
				$('#nombreCliente').val($("#clienteNickName").val());
				let tabla = document.getElementById('tablaListaClientes');
				let row = tabla.insertRow(tabla.rows.length);
				let cell = row.insertCell(0);
				cell.style.textAlign = "left";
				cell.innerHTML = $("#clienteRut").val();
				cell = row.insertCell(1);
				cell.style.textAlign = "left";
				cell.innerHTML = $("#clienteNickName").val();
				cell = row.insertCell(2);
				cell.style.textAlign = "left";
				cell.innerHTML = $("#clienteNombre").val();
				row.setAttribute("onClick", "$('#id_cliente').val('" + id_cliente + "'); $('#rutCliente').val('" + $("#clienteRut").val() + "');$('#nombreCliente').val('" + $("#clienteNickName").val() + "');");
				row.setAttribute("data-dismiss", "modal");
			}
		</script>
	<!-- FIN MODAL CREA CLIENTES -->

	<!-- MODAL CREA PROYECTOS -->
		@modalProyectoNuevo(mapDiccionario, listRegiones)
		<script>
			const proyectoGrabaAjax = (id_proyecto) =>{
				$('#id_proyecto').val(id_proyecto);
				$('#nombreProyecto').val($("#proyectoNickName").val());
				let tabla = document.getElementById('tablaListaProyectos');
				let row = tabla.insertRow(tabla.rows.length);
				let cell = row.insertCell(0);
				cell.style.textAlign = "left";
				cell.innerHTML = $("#proyectoNickName").val();
				cell = row.insertCell(1);
				cell.style.textAlign = "left";
				cell.innerHTML = $("#proyectoNombre").val();
				cell = row.insertCell(2);
				cell.style.textAlign = "left";
				cell.innerHTML = "";
				row.setAttribute("onClick", "$('#id_proyecto').val('" + id_proyecto + "'); $('#nombreProyecto').val('" + $("#proyectoNickName").val() + "');");
				row.setAttribute("data-dismiss", "modal");
			}
		</script>
	<!-- FIN MODAL CREA PROYECTOS -->


	<form action="/routes2/cotiOdoNuevo/" enctype="multipart/form-data" method="POST" onsubmit="return validarForm();">
		<div id="mostrarmostrar" style="display:block;">
			@barraTitulo(mapDiccionario, "INGRESO DE NUEVA COTIZACION ODO", "")
			<div class="row  justify-content-md-center">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<table class="table table-sm table-hover table-bordered table-condensed table-fluid">
						<thead style="background-color: #eeeeee">
							<tr>
								<td width="230px">
									<input type="hidden" id="id_cotiOdo" name="id_cotiOdo" value="@formCotizaOdo.id_cotiOdo">
									<div class="input-group">
								  		<div class="input-group-prepend">
								    		<span class="input-group-text" id="basic-addon1">Nro.Cotizacion</span>
								  		</div>
								  		<input type="text" class="form-control left"
								  				id="numeroCoti"
												name="numeroCoti"
												value = "@formCotizaOdo.numeroCoti"
												onkeydown="return ingresoInt(event,value)"
												onchange="if(value.trim()==''){value='@formCotizaOdo.numeroCoti';}else{validarNumero(value);}">
									</div>
								</td>
								<td width="230px">
									<div class="input-group">
								  		<div class="input-group-prepend">
								    		<span class="input-group-text" id="basic-addon1">Fecha</span>
								  		</div>
								  		<input type="date" class="form-control center"
								  			name="fechaCoti"
								  			id="fechaCoti"
								  			onblur="if(!limitaFecha(value,720,10)) value='@formCotizaOdo.fechaCoti';"
								  			value="@formCotizaOdo.fechaCoti"
						        			required>
									</div>
								</td>
								<td  width="230px">
									<div class="input-group">
								  		<div class="input-group-prepend">
								    		<span class="input-group-text" id="basic-addon1">@mapDiccionario.get("RUT") Cliente</span>
								  		</div>
								  		<input type="hidden" id="id_cliente" name="id_cliente" value="@formCotizaOdo.id_cliente">
										<input type="text" class="form-control"
		  										id="rutCliente"
		  										value="@formCotizaOdo.rutCliente"
		  										style="background:white"
		  										onclick="$('#listaCliente').modal('show');"
		  										readonly>
									</div>
								</td>
								<td>
									<div class="input-group">
								  		<div class="input-group-prepend">
								    		<span class="input-group-text" id="basic-addon1">Cliente</span>
								  		</div>
											<input type="text" class="form-control left"
													id="nombreCliente"
													value="@formCotizaOdo.nickCliente"
													style="background:white"
													onclick='$("#listaCliente").modal("show")'
													required
													readonly>
									</div>
								</td>
								<td>
									<div class="input-group">
								  		<div class="input-group-prepend">
								    		<span class="input-group-text" id="basic-addon1">Proyecto</span>
								  		</div>
										<input type="hidden" id="id_proyecto" name="id_proyecto" value="@formCotizaOdo.id_proyecto">
										<input type="text" class="form-control left"
												id="nombreProyecto"
												value="@formCotizaOdo.nickProyecto"
												style="background:white"
												onclick='$("#listaProyecto").modal("show")'
												readonly>
									</div>
								</td>
								<td>
									<span class="btn btn-info btn-sm btn-file" style="font-size: 8px;">
										<div id="txtBtn">Adjuntar</div>
				    					<input type="file" id="docAdjunto" name="docAdjunto" onchange="LimitAttach(this.form, this.form.docAdjunto.value);">
									</span>
								</td>
							</tr>
							<tr>
								<input type="hidden" id="id_bodegaEmpresa" name="id_bodegaEmpresa" value="@formCotizaOdo.id_bodegaEmpresa">
								<td colspan="20">
									<div class="input-group">
								  		<div class="input-group-prepend">
								    		<span class="input-group-text" id="basic-addon1">Observaciones</span>
								  		</div>
	  									<textarea class="form-control"
	  										name="observaciones"
	  										autocomplete="off">@formCotizaOdo.observaciones</textarea>
									</div>
								</td>
							</tr>
						</thead>
					</table>
					<hr>

					<div class="noprint" align="center">
						<div class="row justify-content-md-center" >
							<div class="col-xs-5 col-sm-2 col-md-2 col-lg-2">
								<input id="btnCopiaCoti" type="button"  value="Copiar desde otra cotización" class="btn btn-warning btn-sm rounded-pill btn-block"
									onclick="$('#modalListaCotizacion').modal('show');">&nbsp;&nbsp;&nbsp;
							</div>
							<div class="col-xs-5 col-sm-2 col-md-2 col-lg-2">
								<input id="btnCargaExcel" type="button"  value="Copiar desde un Excel" class="btn btn-info btn-sm rounded-pill btn-block"
									onclick="$('#modalCargaMasiva').modal('show');">&nbsp;&nbsp;&nbsp;
							</div>
						</div>
					</div>

					<table id="tablaPrincipal" class="table table-sm table-hover table-bordered table-condensed table-fluid" style="width:100%">
						<thead style="background-color: #eeeeee">
							<TR>
								<TH>FAMILIA</TH>
								<TH>CODIGO</TH>
								<TH style="min-width:30%">SERVICIO</TH>
								<TH>UN</TH>
								<TH>CANTIDAD</TH>
						        <TH>MON</TH>
								<TH>PRECIO<br>UNITARIO</TH>
								<TH>TOTAL</TH>
								<TH>Aplica<br>Minimo</TH>
								<TH>Cantidad<br>Minimo</TH>
								<TH>Precio<br>Adicional</TH>
								<TH>EQUIPO<br>ASOCIADO</TH>
								<TH style = "display:none">id_servicio</TH>
								<TH style = "display:none">id_equipo</TH>

							</TR>
						</thead>
						<tbody>
							@for(lista1 <- listadoServicios){
								<TR>
									<td style="text-align:left;">
										<input type="hidden" name="id_servicio[]" value="@lista1.get(0)">
										<input type="hidden" name="id_moneda[]" value="@lista1.get(13)">
										@lista1.get(1)
									</td>
									<td style= "text-align: left;">@lista1.get(2)</td>
									<td style= "text-align: left;">@lista1.get(3)</td>
									<td style= "text-align: center;">@lista1.get(4)</td>
									<td style="text-align:center;">
										<input type="text" class="cantidad form-control height23px right width80px"
											name="cantidad[]"
											id="cantidad_@lista1.get(0)"
											value="@lista1.get(5)"
											onfocus="value=value.replace(/,/g,''); cantAux = value;"
											onblur = "value = formatStandar(value, '2');"
											onkeydown="return ingresoDouble(event,value)"
											autocomplete="off"
											onchange="if(value=='') value=0; calculaLinea('@lista1.get(0)', '@lista1.get(12)');">
									</td>
									<td style="text-align:center;">@lista1.get(6)</td>
									<td style="text-align:center;">
										<input type="text" class="form-control height23px right width100px"
											name="precio[]"
											id="precio_@lista1.get(0)"
											value="@lista1.get(7)"
											onfocus="value=value.replace(/,/g,'');"
											onblur = "value = formatStandar(value, '@lista1.get(12)');"
											onkeydown="return ingresoDouble(event,value)"
											autocomplete="off"
											onchange="if(value=='') value=0; calculaLinea('@lista1.get(0)', '@lista1.get(12)');">
									</td>
									<td id="total_@lista1.get(0)" class="total" style= "text-align: right;">@lista1.get(8)</td>
									<td  style="text-align:center;">
										<input type="hidden" name="aplicaMinimo[]" id="aplicaMinimo_@lista1.get(0)" value="@lista1.get(9)">
										@if(lista1.get(9).equals("0")){
											<input type="checkbox" id="checkbox_@lista1.get(0)" onchange="checkAplicaMinimo('@lista1.get(0)');">
										}else{
											<input type="checkbox" id="checkbox_@lista1.get(0)" onchange="checkAplicaMinimo('@lista1.get(0)');" checked>
										}
									</td>
									<td style="text-align:center;">
										<input type="text" class="cantidad form-control height23px right width80px"
											name="cantidadMinimo[]"
											id="cantidadMinimo_@lista1.get(0)"
											value="@lista1.get(10)"
											onfocus="value=value.replace(/,/g,''); cantAux = value;"
											onblur = "value = formatStandar(value, '2');"
											onkeydown="return ingresoDouble(event,value)"
											autocomplete="off"
											onchange="if(value=='') value=0;">
									</td>
									<td style="text-align:center;">
										<input type="text" class="form-control height23px right width100px"
											name="precioAdicional[]"
											id="precioAdicional_@lista1.get(0)"
											value="@lista1.get(11)"
											onfocus="value=value.replace(/,/g,'');"
											onblur = "value = formatStandar(value, '@lista1.get(12)');"
											onkeydown="return ingresoDouble(event,value)"
											autocomplete="off"
											onchange="if(value=='') value=0;">
									</td>
									<td style= "text-align: left;">
										<input type="text" class="form-control"
										id="equipoAsociado_@lista1.get(0)"
										value=" - "
										style="background:white"
										onclick="auxEquipoAsociado = '@lista1.get(0)'; $('#listaEquipos').modal('show');"
										readonly>
									</td>
									<td style = "display:none" id="idServicio_@lista1.get(0)">@lista1.get(0)</td>
									<td style = "display:none" >
										<input type="hidden" id="idEquipo_@lista1.get(0)" name="id_equipo[]" value="0">
									</td>
								</TR>
				 			}
						</tbody>
						<tfoot id="tfoot" style="background-color: #eeeeee; display:none">
							<TR>
								<TH colspan="4" style= "text-align: right;">SUB-TOTALES </TH>
								<TH style="text-align:right;"><div id="subTotCant">0.00</div></TH>
								<TH colspan="2"></TH>
								<TH style="text-align:right;"><div id="subTotPrecio">0.00</div></TH>
								<TH colspan="4"></TH>
								<TH style = "display:none"></TH>
								<TH style = "display:none"></TH>
							</TR>
							<TR>
								<TH colspan="4" style="text-align:right;">DESCUENTO</TH>
								<TH colspan="3"></TH>
								<TH style="text-align:center;">
									<input type="text" class="form-control height23px right"
										id="dctoOdo"
										name="dctoOdo"
										value="@formCotizaOdo.dctoOdo %"
										onfocus="value=value.replace(/,/g,'').replace(/%/g,'').replace(/ /g,'')"
										onblur = "value = formatPorcentaje(value);"
										onkeydown="return ingresoDouble(event,value)"
										onchange="sumaTotales();">
									</td>
								</TH>
								<TH colspan="4"></TH>
								<TH style = "display:none"></TH>
								<TH style = "display:none"></TH>
							</TR>
							<TR>
								<TH colspan="4" style= "text-align: right;">TOTALES </TH>
								<TH style="text-align:right;"><div id="granTotCant">0.00</div></TH>
								<TH colspan="2"></TH>
								<TH style="text-align:right;"><div id="granTotPrecio">0.00</div></TH>
								<TH colspan="4"></TH>
								<TH style = "display:none"></TH>
								<TH style = "display:none"></TH>
							</TR>
						</tfoot>
					</table>
				</div>
			</div>


			<div class="noprint" align="left">
				<div class="row justify-content-md-center" >
					<div class="col-xs-5 col-sm-1 col-md-1 col-lg-1">
						<input type="button"  value="Cancelar" class="btn btn-light btn-sm rounded-pill btn-block" onclick="location.href='/home/';">
					</div>
					<div class="col-xs-5 col-sm-1 col-md-1 col-lg-1">
						<input type="button"  id="verifica" value='Verificar' class="btn btn-success btn-sm rounded-pill btn-block" onclick="verificaCotizaOdo();" >
					</div>
					<div class="col-xs-5 col-sm-1 col-md-1 col-lg-1">
						<input type="button"  id="modifica" value='Modificar' class="btn btn-warning btn-sm rounded-pill btn-block" onclick="modificaCotizacion();" style="visibility:hidden">
					</div>
					<div class="col-xs-5 col-sm-1 col-md-1 col-lg-1">
						<input type="submit"  id="aplica" value='Confirmar' class="btn btn-primary btn-sm rounded-pill btn-block" style="visibility:hidden">
					</div>
				</div>
			</div>

		</div>
	</form>
	<br><br><br><br><br>





	<div id="listaCliente" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">SELECCIONAR CLIENTE</h5>
				        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				          <span aria-hidden="true">&times;</span>
				        </button>
				</div>
				<div class="modal-body">
					<div class="noprint" align="center">
						<a href="#" onclick="$('#listaCliente').modal('hide'); $('#modalClienteNuevo').modal('show');">
							<kbd style="background-color: #73C6B6">Agregar Nuevo</kbd>
						</a>
					</div>
					<table id="tablaListaClientes" class="table table-sm table-bordered table-condensed table-hover table-fluid">
						<thead style="background-color: #eeeeee">
							<TR>
								<TH>@mapDiccionario.get("RUT")</TH>
								<TH>NICK</TH>
								<TH>NOMBRE</TH>
							</TR>
						</thead>
						<tbody>
							@for(lista1 <- listClientes){
								<TR onClick="$('#id_cliente').val(@lista1.getId()); $('#rutCliente').val('@lista1.getRut()');$('#nombreCliente').val('@lista1.getNickName()');" data-dismiss="modal">
									<td  style="text-align:left;">@lista1.getRut()</td>
									<td  style="text-align:left;">@lista1.getNickName()</td>
									<td  style="text-align:left;">@lista1.getNombre()</td>
								</TR>
				 			}
						</tbody>
					</table>
	   				<div class="row">
						<div class="col-sm-12" style="text-align:center">
							<button type="button" class="btn btn-sm  btn-warning" style="font-size: 10px;" data-dismiss="modal">Cancelar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="listaEquipos" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">SELECCIONAR EQUIPO ASOCIADO</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="noprint" align="center">
						<a href="#" onclick="$('#listaCliente').modal('hide'); $('#modalClienteNuevo').modal('show');">
							<kbd style="background-color: #73C6B6">Agregar Nuevo</kbd>
						</a>
					</div>
					<table id="tablaListaEquipos" class="table table-sm table-bordered table-condensed table-hover table-fluid">
						<thead style="background-color: #eeeeee">
							<TR>
								<TH>CODIGO</TH>
								<TH>EQUIPO</TH>
							</TR>
						</thead>
						<tbody>
							<TR onClick="
									$('#idEquipo_'+auxEquipoAsociado).val('0');
									$('#equipoAsociado_'+auxEquipoAsociado).val(' - ');" data-dismiss="modal">
								<td  style="text-align:left;">Sin Equipo</td>
								<td  style="text-align:left;">Sin Equipo</td>
							</TR>
							@for(lista1 <- listEquipos){
								<TR onClick="
										$('#idEquipo_'+auxEquipoAsociado).val('@lista1.getId()');
										$('#equipoAsociado_'+auxEquipoAsociado).val('@lista1.getCodigo() - @lista1.getNombre()');" data-dismiss="modal">
									<td  style="text-align:left;">@lista1.getCodigo()</td>
									<td  style="text-align:left;">@lista1.getNombre()</td>
								</TR>
							}
						</tbody>
					</table>
					<div class="row">
						<div class="col-sm-12" style="text-align:center">
							<button type="button" class="btn btn-sm  btn-warning" style="font-size: 10px;" data-dismiss="modal">Cancelar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="listaProyecto" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">SELECCIONAR CLIENTE</h5>
				        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				          <span aria-hidden="true">&times;</span>
				        </button>
				</div>
				<div class="modal-body">
					<div class="noprint" align="center">
						<a href="#" onclick="$('#listaProyecto').modal('hide'); $('#modalProyectoNuevo').modal('show');">
							<kbd style="background-color: #73C6B6">Agregar Nuevo</kbd>
						</a>
					</div>
					<table id="tablaListaProyectos" class='table table-sm table-bordered table-condensed table-hover table-fluid'>
						<thead style="background-color: #eeeeee">
							<TR>
								<TH>NICK</TH>
								<TH>NOMBRE</TH>
								<TH>@mapDiccionario.get("Comuna")</TH>
							</TR>
						</thead>
						<tbody>
							@for(lista1 <- listProyectos){
								<TR onClick="$('#id_proyecto').val(@lista1.getId()); $('#nombreProyecto').val('@lista1.getNickName()');" data-dismiss="modal">
									<td  style="text-align:left;">@lista1.getNickName()</td>
									<td  style="text-align:left;">@lista1.getNombre()</td>
									<td  style="text-align:left;">@lista1.getComuna()</td>
								</TR>
				 			}
						</tbody>
					</table>
	   				<div class="row">
						<div class="col-sm-12" style="text-align:center">
							<button type="button" class="btn btn-sm  btn-warning" style="font-size: 10px;" data-dismiss="modal">Cancelar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>



	<div id="modalListaCotizacion" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
		<div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">COTIZACIONES DISPONIBLES</h5>
				        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				          <span aria-hidden="true">&times;</span>
				        </button>
				</div>
				<div class="modal-body">
					<table id="tablaListaCotizacion" class="table table-sm table-bordered table-condensed table-hover table-fluid">
						<thead style="background-color: #eeeeee">
							<TR>
								<TH>NUMERO</TH>
								<TH>FECHA</TH>
								<TH>CLIENTE</TH>
								<TH>PROYECTO</TH>
							</TR>
						</thead>
						<tbody>
							@for(lista1 <- listCotiOdo){
								<TR onClick="seleccionaCotizacion('@lista1.get(0)')" data-dismiss="modal">
									<td  style="text-align:center;">@lista1.get(1)</td>
									<td  style="text-align:center;">
										<div style="display:none">@utilities.Fechas.AAMMDD(lista1.get(2))</div>
										@utilities.Fechas.DDMMAA(lista1.get(2))
									</td>
									<td  style="text-align:left;">@lista1.get(3)</td>
									<td  style="text-align:left;">@lista1.get(4)</td>
								</TR>
				 			}
						</tbody>
					</table>
	   				<div class='row'>
						<div class='col-sm-12' style='text-align:center'>
							<button type='button' class='btn btn-sm  btn-warning' style='font-size: 10px;' data-dismiss='modal'>Cancelar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="modalCargaMasiva" class="modal" role="dialog" data-backdrop="static" data-keyboard="false">
	  <div class="modal-dialog modal-sm modal-dialog-scrollable" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Carga masiva de equipos</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">

			<div class="row">
				<div class="col-sm-12" style="text-align:center">
					<form action="/routes2/cotiOdoPlantilla/" method="POST">
						<button type="submit" class="btn btn-sm  btn-success" style="font-size: 10px;">DESCARGAR PLANTILLA</button>
					</form>
					<br>
					<form id="cotiOdoValidarPlantilla" action="/routes2/cotiOdoValidarPlantilla/" method="POST" enctype="multipart/form-data">
						<span class="btn btn-info btn-sm btn-file" style="font-size: 8px;">
							<div>SUBIR ARCHIVO</div>
							<input type="hidden" id="id_bodegaEmpresa" name="id_bodegaEmpresa" value="@formCotizaOdo.id_bodegaEmpresa">
							<input type="file" id="archivoXLSX" name="archivoXLSX" value="" onchange="subirArchivo(this.form, this.form.archivoXLSX.value)">
						</span>
					</form>
					<br>
					<button type="button" class="btn btn-sm  btn-warning" style="font-size: 10px;" data-dismiss="modal">Cancelar</button>
				</div>
			</div>
			<br>
	      </div>
	    </div>
	  </div>
	</div>


}



<script type="text/javascript">
	let auxEquipoAsociado = "";

	$(document).ready(function() {
		$('#tablaListaClientes').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
	    	"order": [[ 1, "asc" ]],
	    	"language": {
	        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
	        }
	  	} );

		$('#tablaListaEquipos').DataTable({
			"fixedHeader": true,
			"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
			"order": [[ 1, "asc" ]],
			"language": {
				"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
			}
		} );

		$('#tablaListaProyectos').DataTable({
	    	"fixedHeader": true,
	    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
	    	"order": [[ 0, "asc" ]],
	    	"language": {
	        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
	        }
	  	} );

		sumaTotales();
		
		$('#tablaPrincipal').DataTable({
				"responsive": true,
		    	"fixedHeader": true,
		    	"lengthMenu": [[15, 50, 100, 200, -1], [15, 50, 100, 200, "All"]],
		    	"order": [[ 2, "asc" ]],
		    	"language": {
		        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
		        }
		} );
		
		$('#tablaListaCotizacion').DataTable({
		    	"fixedHeader": true,
		    	"lengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
		    	"order": [[ 1, "desc" ],[ 0, "desc" ]],
		    	"language": {
		        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
		        }
		} );
		  
		document.getElementById('mostrarmostrar').style.display="block";
	});
	
	const validarNumero = (numero) =>{
		var formData = new FormData();
		formData.append('numeroCoti',numero);
        $.ajax({
            url: "/routes2/existeNumeroCotiOdoAjax/",
            type: "POST",
            method: "POST",
            data: formData,
            cache: false,
            contentType: false,
	     	processData: false,
	     	success: function(respuesta){
				if(respuesta!="OK"){
					$("#numeroCoti").val("@formCotizaOdo.numeroCoti");
					alertify.alert(respuesta, function () { });
				}
	     	}
        });
	}
	
	
	
	const sumaTotales = () =>{
		$("#tablaPrincipal").dataTable().fnDestroy();
		let tabla = document.getElementById("tablaPrincipal");
		let totCant = 0;
		
		let cant = 0;
		$(".cantidad").each(function() {
			let val = $(this).val().replace(/,/g,'');
			cant += parseFloat(val);
		});
		$("#subTotCant").text(formatStandar(cant,'2'));
		$("#granTotCant").text(formatStandar(cant,'2'));
		
		let total = 0;
		$(".total").each(function() {
			let val = $(this).text().replace(/,/g,'');
			total += parseFloat(val);
		}); 
		$("#subTotPrecio").text(formatStandar(total,'@numDec'));
		
		let dctoOdo = $("#dctoOdo").val().replace(/,/g,'').replace("%","").trim();
		
		$("#granTotPrecio").text(formatStandar((total*(1-dctoOdo/100)),'@numDec'));
		
		
		
		
	}
	
	
	
	
	const checkAplicaMinimo = (id_servicio) =>{
		let aplicaMinimo = $("#aplicaMinimo_"+id_servicio).val();
		if(aplicaMinimo==0){
			$("#aplicaMinimo_"+id_servicio).val('1');
		}else{
			$("#aplicaMinimo_"+id_servicio).val('0');
		}
	}
	
	
	
	
	
	const calculaLinea = (id_servicio, numDec) =>{
		let cant = $("#cantidad_"+id_servicio).val().replace(/,/g,'');
		let precio = $("#precio_"+id_servicio).val().replace(/,/g,'');
		let total = parseFloat(cant) * parseFloat(precio);
		$("#total_"+id_servicio).text(formatStandar(total,numDec));
		if(verificando == 1){
			sumaTotales();
		}
		
	}
	
	
	
	
	let verificando = 0;
	const verificaCotizaOdo = () =>{
		document.getElementById("btnCopiaCoti").style.display = "none";
		document.getElementById("btnCargaExcel").style.display = "none";
		sumaTotales();
		
		
		
		let subTotPrecio = $("#subTotPrecio").text().replace(/,/g,'');
		
		let sumaAux = parseFloat(subTotPrecio);
		
		if(sumaAux > 0){
			let tabla = document.getElementById("tablaPrincipal");
			for(i=1; i<tabla.rows.length-3; i++){
				let cant = $(".cantidad",tabla.rows[i].cells[4]).val().replace(/,/g,'');
				let precio = tabla.rows[i].cells[7].innerHTML.replace(/,/g,'');
				if((parseFloat(cant)+parseFloat(precio))<=0){
					tabla.rows[i].style.display = 'none';
				}
			}
			verificando = 1;
			document.getElementById('tfoot').style.display = '';
			document.getElementById('modifica').style.visibility = 'visible';
			document.getElementById('aplica').style.visibility = 'visible';
			
			
		}else{
			$('#tablaPrincipal').DataTable({
		    	"fixedHeader": true,
		    	"lengthMenu": [[15, 50, 100, 200, -1], [15, 50, 100, 200, "All"]],
		    	"order": [[ 2, "asc" ]],
		    	"language": {
		        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
		        }
			} );
			alertify.alert('NO PUEDE VERIFICAR UNA COTIZACION SIN CANTIDADES', function () { });
		}
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	const modificaCotizacion = () =>{
		let tabla = document.getElementById("tablaPrincipal");
		for(i=1; i<tabla.rows.length-3; i++){
			tabla.rows[i].style.display = '';
		}
		$('#tablaPrincipal').DataTable({
		    	"fixedHeader": true,
		    	"lengthMenu": [[15, 50, 100, 200, -1], [15, 50, 100, 200, "All"]],
		    	"order": [[ 2, "asc" ]],
		    	"language": {
		        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
		        }
		} );
		document.getElementById('tfoot').style.display = 'none';
		document.getElementById('modifica').style.visibility = 'hidden';
		document.getElementById('aplica').style.visibility = 'hidden';
		verificando = 0;
	}
	
	const seleccionaCotizacion = (id_cotiOdo) =>{
		document.getElementById("btnCopiaCoti").style.display = "none";
		document.getElementById("btnCargaExcel").style.display = "none";
		let formData = new FormData();
	    formData.append('id_cotiOdo',id_cotiOdo);
		$.ajax({
            url: "/routes2/cotiOdoModificaJson/",
            type: "POST",
            method: "POST",
            data: formData,
            cache: false,
            contentType: false,
	     	processData: false,
	     	success: function(respuesta){
	     		let obj = JSON.parse(respuesta);
	     		let mapCantidad = new Map();
	     		let mapPrecio = new Map();
	     		let mapAplicaMinimo = new Map();
	     		let mapCantidadMinimo = new Map();
	     		let mapPrecioAdicional = new Map();
	     		let mapNroDecimal = new Map();
	     		
	     		for(i=0;i<obj.length;i++){
	     			mapCantidad.set(obj[i].id_servicio,obj[i].cantidad);
	     			mapPrecio.set(obj[i].id_servicio,obj[i].precio);
	     			mapAplicaMinimo.set(obj[i].id_servicio,obj[i].aplicaMinimo);
	     			mapCantidadMinimo.set(obj[i].id_servicio,obj[i].cantidadMinimo);
	     			mapPrecioAdicional.set(obj[i].id_servicio,obj[i].precioAdicional);
	     			mapNroDecimal.set(obj[i].id_servicio,obj[i].nroDecimal);
	     		}
	     		
				$("#tablaPrincipal").dataTable().fnDestroy();
				let tableReg = document.getElementById("tablaPrincipal");
				
				for (let i = 1; i < tableReg.rows.length-3; i++){
					let cellsOfRow = tableReg.rows[i].getElementsByTagName('td');
					let id_servicio = cellsOfRow[11].innerHTML;
					
					let cantidad = mapCantidad.get(id_servicio);
					
					if(cantidad != null){
						let precio = mapPrecio.get(id_servicio);
						let aplicaMinimo = mapAplicaMinimo.get(id_servicio);
						let cantidadMinimo = mapCantidadMinimo.get(id_servicio);
						let precioAdicional = mapPrecioAdicional.get(id_servicio);
						let nroDecimales = mapNroDecimal.get(id_servicio);
						
			 			if(cantidad == null) cantidad = 0;
						if(aplicaMinimo == null) aplicaMinimo = 0;
						if(cantidadMinimo == null) cantidadMinimo = 0;
						if(precioAdicional == null) precioAdicional = 0;
						if(nroDecimales == null) nroDecimales = 0;
						
						$("#cantidad_"+id_servicio).val(cantidad);
						$("#precio_"+id_servicio).val(precio);
						$("#aplicaMinimo_"+id_servicio).val(aplicaMinimo);
						if(aplicaMinimo==1){
							document.getElementById("checkbox_"+id_servicio).checked = true;
						}else{
							document.getElementById("checkbox_"+id_servicio).checked = false;
						}
						$("#cantidadMinimo_"+id_servicio).val(cantidadMinimo);
						$("#precioAdicional_"+id_servicio).val(precioAdicional);
						calculaLinea(id_servicio, nroDecimales);
					}
					
				}
				sumaTotales();
				$('#tablaPrincipal').DataTable({
			    	"fixedHeader": true,
			    	"lengthMenu": [[15, 50, 100, 200, -1], [15, 50, 100, 200, "All"]],
			    	"order": [[ 2, "asc" ]],
			    	"language": {
			        	"url": "https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
			        }
				});
	     	}


        });
	}

	const validarForm = () =>{
		let flag = true;
		sumaTotales();
		let granTotPrecio = $("#granTotPrecio").text().replace(/,/g,'');
		if(granTotPrecio <= 0){
			flag = false;
			alertify.alert('NO PUEDE CONFIRMAR UNA COTIZACION SIN CANTIDADES Y PRECIOS', function () {
				return(flag);
     		});
		}else if($("#id_cliente").val()=='0'){
			flag = false;
			alertify.alert('NO PUEDE CONFIRMAR UNA COTIZACION SIN ASIGNAR UN CLIENTE', function () {
				return(flag);
     		});
		}else{
			let tabla = document.getElementById("tablaPrincipal");
			for(i=1; i<tabla.rows.length-3; i++){
				let cant = $(".cantidad",tabla.rows[i].cells[4]).val().replace(/,/g,'');
				if(parseFloat(cant)<=0){
					tabla.deleteRow(i);
					i--;
				}
			}
			return(true);
		}
		return(flag);
	}
	
	
	
	
	
	

	let extArray = new Array(".gif", ".jpg", ".png", ".jpeg", ".pdf", ".xls", ".doc", ".xlsx", ".docx", ".tar", ".zip", ".rar");
	const LimitAttach = (form, file) => {
		let allowSubmit = false;
		if (!file) return;
		while (file.indexOf("\\") != -1){
			file = file.slice(file.indexOf("\\") + 1);
		}
		let extencion = file.slice(file.lastIndexOf(".")).toLowerCase();
		for (var i = 0; i < extArray.length; i++) {
			if (extArray[i] == extencion) { allowSubmit = true; break; }
		}
		if (allowSubmit) {
			var file = $("#docAdjunto")[0].files[0];
			var fileSize = file.size; //tamaño del archivo
			if(fileSize>100000000){
				alert("Se permiten únicamente archivos que no superen los 100 MB,"
				+" el que se intenta subir pesa: "+Math.round(file.size/10)/100+" KB");
				form.docAdjunto.value="";
			}else{
				alert("Documento subido con éxito");
				$("#txtBtn").text("Cambiar Documento");
			}
		}else{
			alert("Se permiten únicamente archivos con la extención: " 
			+ (extArray.join("  ")) + "\nPor favor, seleccione otro archivo "
			+ "e intente de nuevo.");
			form.docAdjunto.value="";
		}
	}
	
	let extArray2 = new Array(".xls", ".xlsx");
	function subirArchivo(form, file) {
		allowSubmit = false;
		if (!file) return;
		while (file.indexOf("\\") != -1)
			file = file.slice(file.indexOf("\\") + 1);
		ext = file.slice(file.lastIndexOf(".")).toLowerCase();
		for (var i = 0; i < extArray2.length; i++) {
			if (extArray2[i] == ext) { allowSubmit = true; break; }
		}
		if (allowSubmit) {
			$("#cotiOdoValidarPlantilla").submit();
		}else{
			alertify.alert("Se permiten &uacute;nicamente archivos con la extenci&oacute;n: " 
			+ (extArray2.join("  ")) + "\nPor favor, seleccione otro archivo "
			+ "e intente de nuevo.");
			form.archivoXLSX.value="";
		}
	}


	
</script>


		
		
	
